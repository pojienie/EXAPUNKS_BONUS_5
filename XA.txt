;remember to change the default mode to LOCAL
GRAB 300
LINK 800

MARK FIND_FIRST_X
TEST F > -1
TJMP FIND_FIRST_X
SEEK -1
COPY 9900 F

MARK FIND_REMAINING_X
COPY 100 X

MARK F_R_X_LOOP
TEST EOF
TJMP FOUND_ALL
ADDI X 100 X
TEST F > -1
TJMP F_R_X_LOOP

SEEK -1
COPY X F
JUMP FIND_REMAINING_X

MARK FOUND_ALL
DIVI X -100 X
SUBI X 1 F

MARK TEST_PHONE
SEEK -9999
@REP 11
MODI F 100 #DIAL
@END
REPL TEST_LINK
NOOP
NOOP
TEST MRD
TJMP CORRECT_NUMBER
JUMP FIND_LAST_DIGIT

MARK CORRECT_NUMBER
VOID M
COPY -1 #DIAL
SEEK -9999
MODE ;GLOBAL
@REP 11
MODI F 100 M
@END
MODE ;LOCAL

MARK FIND_LAST_DIGIT
SEEK F

MARK ADD_ONE
ADDI F 1 X
SEEK -1
COPY X F
SEEK -1

MARK CARRY
; CHECK IF NEED CARRY
MODI F 100 X
TEST X < 10
TJMP TEST_PHONE

;NEED CARRY, CHECK SEEK
SEEK -1
DIVI F 100 X 
TEST X = 99
TJMP DONE

; NOT END, SUB 10, SEEK
SEEK -1
COPY F X
DIVI X 100 T ;SEEK
SUBI X 10 X
SEEK -1
COPY X F

MULI T -1 T
SEEK T
JUMP ADD_ONE

MARK TEST_LINK
LINK 800
LINK -1
COPY 0 M
HALT

MARK DONE
LINK -1
KILL
